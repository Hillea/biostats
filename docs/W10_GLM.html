<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Dr.&nbsp;Lea Hildebrandt">

<title>Biostatistics - 10 The General Linear Model &amp; Multivariate Statistics</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./W10_GLM.html">10 The General Linear Model &amp; Multivariate Statistics</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Biostatistics</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./W1_Intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">01a Introduction to Biostatistics</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./W1b_IntroR.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">01b Intro to R</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./W2_Models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">02 Models</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./W3_DataWranglingR.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">03 Data Wrangling</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./W4_DataVizR.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">04 Data Visualization</span></a>
  </div>
</li>
        <li class="sidebar-item">
 <span class="menu-text">W5_Sampling.qmd</span>
  </li>
        <li class="sidebar-item">
 <span class="menu-text">W6_ProbabilityR.qmd</span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./W7_Hypothesis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">07 Hypothesis Testing</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./W8_ModelingRelationships.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">08 Modeling Relationships</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./W9_FirstAnalysisR.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">09 Statistical Analyses in R</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./W10_GLM.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">10 The General Linear Model &amp; Multivariate Statistics</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./W11_GLMinR.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">11 ANOVA &amp; the General Linear Model in R</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./W12_LMM.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">12 Linear Mixed Models</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./W13_RMarkdown.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">13 R Markdown</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./W15_RepResearchR.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">15 Reproducible Research</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        
    <div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="W10_GLM.html"><i class="bi bi-file-slides"></i>RevealJS</a></li></ul></div></div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">10 The General Linear Model &amp; Multivariate Statistics</h1>
<p class="subtitle lead"></p><div class="line-block">Julius-Maximilians-University Würzburg<br>
Course: “Biostatistics”<br>
Translational Neuroscience</div><p></p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Dr.&nbsp;Lea Hildebrandt </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="general-linear-model-glm" class="level1 page-columns page-full">
<h1>General Linear Model (GLM)</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode css code-with-copy"><code class="sourceCode css"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>code<span class="fu">.sourceCode</span> {</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">font-size</span><span class="ch">:</span> <span class="dv">1.4</span><span class="dt">em</span><span class="op">;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>div<span class="fu">.cell-output-stdout</span> {</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">font-size</span><span class="ch">:</span> <span class="dv">1.4</span><span class="dt">em</span><span class="op">;</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<style type="text/css">
code.sourceCode {
  font-size: 1.4em;
}

div.cell-output-stdout {
  font-size: 1.4em;
}
</style>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fivethirtyeight)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">#library(caret)</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cowplot)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123456</span>) <span class="co"># set random seed to exactly replicate results</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">tidy.opts=</span><span class="fu">list</span>(<span class="at">width.cutoff=</span><span class="dv">80</span>))</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">tibble.width =</span> <span class="dv">60</span>)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co"># load the NHANES data library</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(NHANES)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co"># drop duplicated IDs within the NHANES dataset</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>NHANES <span class="ot">&lt;-</span> </span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  NHANES <span class="sc">%&gt;%</span> </span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">distinct</span>(ID,<span class="at">.keep_all=</span><span class="cn">TRUE</span>)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>NHANES_adult <span class="ot">&lt;-</span> </span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  NHANES <span class="sc">%&gt;%</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(Weight) <span class="sc">%&gt;%</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(Age<span class="sc">&gt;=</span><span class="dv">18</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Remember the basic model of statistics:</p>
<p><span class="math display">\[
data = model + error
\]</span></p>
<p>Our general goal is to find the model with the <em>best fit</em>, i.e., that minimizes the error.</p>
<p>. . .</p>
<p>One approach is the GLM. You might be surprised that a lot of the common models can be viewed as linear models:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/linear_tests_cheat_sheet.png" class="img-fluid figure-img"></p>
<figcaption>All models can be thought of as linear models</figcaption>
</figure>
</div>
<section id="definitions" class="level2">
<h2 class="anchored" data-anchor-id="definitions">Definitions</h2>
<p><strong>Dependent variable (DV)</strong>: The outcome variable that the model aims to explain (<span class="math inline">\(Y\)</span>).</p>
<p><strong>Independent variable (IV)</strong>: The variable(s) that we use to explain the DV (<span class="math inline">\(X\)</span>).</p>
<p><strong>Linear model</strong>: The model for the DV is composed of a <em>linear combination</em> of IVs (that are multiplied by different <u>weights</u>!)</p>
<p>. . .</p>
<p>The weights are the <em>parameters</em> <span class="math inline">\(\beta\)</span> and determine the relative contribution of each IV. (This is what the model estimates! The weights thus give us the important information we’re usually interested in: How strong are IV and DV related.)</p>
<p>There may also be several DVs (“<em>multivariate statistics</em>”), but usually that’s not the case except for specific biopsychological methods (e.g., fMRI). Thus, we will focus on those cases with one DV!</p>
</section>
<section id="example" class="level2">
<h2 class="anchored" data-anchor-id="example">Example</h2>
<div class="columns">
<div class="column">
<p>Let’s use some simulated data:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="W10_GLM_files/figure-html/unnamed-chunk-3-1.png" style="height:50.0%" width="288" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</div><div class="column">
<p>We can calculate the <em>correlation</em> between the two variables:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's product-moment correlation

data:  df$grade and df$studyTime
t = 2.0134, df = 6, p-value = 0.09073
alternative hypothesis: true correlation is not equal to 0
95 percent confidence interval:
 -0.1261283  0.9255245
sample estimates:
      cor 
0.6349813 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>r(6) = .63 [-.13; .93], p = .091</code></pre>
</div>
</div>
<p>The correlation is quite high (.63), but the CI is also pretty wide.</p>
</div>
</div>
<p>. . .</p>
<p>Fundamental activities of statistics:</p>
<ul>
<li><p><em>Describe</em>: How strong is the relationship between grade and study time?</p></li>
<li><p><em>Decide</em>: Is there a statistically significant relationship between grade and study time?</p></li>
<li><p><em>Predict</em>: Given a particular amount of study time, what grade do we expect?</p></li>
</ul>
<div class="notes">
<p>relationship study time and grade</p>
</div>
</section>
<section id="linear-regression" class="level2">
<h2 class="anchored" data-anchor-id="linear-regression">Linear Regression</h2>
<p>Use the GLM to…</p>
<div class="incremental">
<ul class="incremental">
<li><p>describe the relation between two variables (similar to correlation)</p></li>
<li><p>predict DV for new values of IV (new observations)</p></li>
<li><p>add multiple IVs!</p></li>
</ul>
</div>
<p>. . .</p>
<div class="columns">
<div class="column">
<p>Simple GLM (here: equivalent to linear regression):</p>
<p><span class="math display">\[
y = \beta_0+ x * \beta_x + \epsilon
\]</span></p>
<p><span class="math inline">\(\beta_0\)</span> = <em>intercept</em>: the overall offset of the line when <span class="math inline">\(x=0\)</span> (this cannot always be interpreted)<br>
<span class="math inline">\(\beta_x\)</span> = <em>slope</em>: how much do we expect <span class="math inline">\(y\)</span> to change with each change in <span class="math inline">\(x\)</span>?<br>
<span class="math inline">\(y\)</span> = <em>DV</em><br>
<span class="math inline">\(x\)</span> = <em>IV</em> or <em>predictor<br>
</em><span class="math inline">\(\epsilon\)</span> = error term* or <em>resudials</em>: whatever variance is left once the model is fit (Think of the model as the blue line and the residuals are the vertical deviations of the data points from the line)</p>
<p>(If we refer to <em>predicted</em> <span class="math inline">\(y\)</span>-values, after we have estimated the model, we can drop the error term: <span class="math inline">\(\hat{y} = \hat{\beta_0} + x * \hat{\beta_x}\)</span>.)</p>
</div><div class="column">
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="W10_GLM_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="the-relation-between-correlation-and-regression" class="level2">
<h2 class="anchored" data-anchor-id="the-relation-between-correlation-and-regression">The Relation Between Correlation and Regression</h2>
<p>There is a close relation and we can convert <span class="math inline">\(r\)</span> to <span class="math inline">\(\hat{\beta_x}\)</span>.</p>
<p><span class="math inline">\(\hat{r} = \frac{covariance_{xy}}{s_x * s_y}\)</span></p>
<p><span class="math inline">\(\hat{\beta_x} = \frac{covariance_{xy}}{s_x*s_x}\)</span></p>
<p><span class="math inline">\(covariance_{xy} = \hat{r} * s_x * s_y\)</span></p>
<p><span class="math inline">\(\hat{\beta_x} = \frac{\hat{r} * s_x * s_y}{s_x * s_x} = r * \frac{s_y}{s_x}\)</span></p>
<p>–&gt; Regression slope = correlation multiplied by ratio of SDs (if SDs are equal, <span class="math inline">\(r\)</span> = <span class="math inline">\(\hat{\beta}\)</span> )</p>
<div class="notes">
<p>Estimation of GLM:</p>
<p>linear algebra (R will do that for us!) –&gt; Appendix book</p>
</div>
</section>
<section id="standard-errors-for-regression-models" class="level2">
<h2 class="anchored" data-anchor-id="standard-errors-for-regression-models">Standard Errors for Regression Models</h2>
<p>We usually want to make inferences about the regression parameter estimates. For this we need an estimate of their variability.</p>
<p>We first need an estimate of how much variability is <em>not</em> explained by the model: the <strong>residual variance</strong> (or <strong>error variance</strong>):</p>
<p>Compute <em>residuals</em>:</p>
<p><span class="math display">\[
residual = y - \hat{y} = y - (x*\hat{\beta_x} + \hat{\beta_0})
\]</span></p>
<p>Compute <em>Sum of Squared Errors</em> (remember from ANOVA?):</p>
<p><span class="math display">\[
SS_{error} = \sum_{i=1}^n{(y_i - \hat{y_i})^2} = \sum_{i=1}^n{residuals^2}
\]</span></p>
<p>Compute <em>Mean Squared Error</em>:</p>
<p><span class="math display">\[
MS_{error} = \frac{SS_{error}}{df} = \frac{\sum_{i=1}^n{(y_i - \hat{y_i})^2} }{N - p}
\]</span></p>
<p>where the <span class="math inline">\(df\)</span> are the number of observations <span class="math inline">\(N\)</span> - the number of estimated parameter <span class="math inline">\(p\)</span> (in this case 2: <span class="math inline">\(\hat{\beta_0}\)</span> and <span class="math inline">\(\hat{\beta_x}\)</span>).</p>
<p>Finally, we can calculate the <em>standard error</em> for the <em>full</em> model:</p>
<p><span class="math display">\[
SE_{model} = \sqrt{MS_{error}}
\]</span></p>
<p>We can also calculate the SE for specific regression parameter estimates by rescaling the <span class="math inline">\(SE_{model}\)</span>:</p>
<p><span class="math display">\[
SE_{\hat{\beta_x}} = \frac{SE_{model}}{\sqrt{\sum{(x_i - \bar{x})^2}}}
\]</span></p>
<div class="notes">
<p>rescaling SE: by square root of the SS of the X variable</p>
</div>
</section>
<section id="statistical-tests-for-regression-parameters" class="level2">
<h2 class="anchored" data-anchor-id="statistical-tests-for-regression-parameters">Statistical Tests for Regression Parameters</h2>
<p>With the parameter estimates and their standard errors, we can compute <span class="math inline">\(t\)</span>-statistics, which represent the likelihood of the observed estimate vs.&nbsp;the expected value under <span class="math inline">\(H_0\)</span> (usually 0, no effect).</p>
<p><span class="math display">\[
\begin{array}{c}
t_{N - p} = \frac{\hat{\beta} - \beta_{expected}}{SE_{\hat{\beta}}}\\
t_{N - p} = \frac{\hat{\beta} - 0}{SE_{\hat{\beta}}}\\
t_{N - p} = \frac{\hat{\beta} }{SE_{\hat{\beta}}}
\end{array}
\]</span></p>
</section>
<section id="glm-results" class="level2">
<h2 class="anchored" data-anchor-id="glm-results">GLM results</h2>
<p>Usually, we would just let R do the calculations:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lmResult)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = grade ~ studyTime, data = df)

Residuals:
    Min      1Q  Median      3Q     Max 
-10.656  -2.719   0.125   4.703   7.469 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   76.156      5.161  14.756 6.09e-06 ***
studyTime      4.313      2.142   2.013   0.0907 .  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 6.386 on 6 degrees of freedom
Multiple R-squared:  0.4032,    Adjusted R-squared:  0.3037 
F-statistic: 4.054 on 1 and 6 DF,  p-value: 0.09073</code></pre>
</div>
</div>
<p>The intercept is significantly different from zero (which is usually not very relevant: with 0 study time, you don’t get 0%) and the effect of <code>studyTime</code> is not (or only “marginally”) significant. So for every hour that we study more, the effect on the grade is <em>descriptively</em> rather small (~4%) but possibly not present at all (because it is not <em>statistically</em> significant).</p>
<div class="notes">
<p><span class="math inline">\(t\)</span> ratio of <span class="math inline">\(\beta\)</span> to its <span class="math inline">\(SE\)</span>!</p>
<p>intercept: expected grade without studying at all</p>
</div>
</section>
<section id="quantifying-goodness-of-fit-of-the-model" class="level2">
<h2 class="anchored" data-anchor-id="quantifying-goodness-of-fit-of-the-model">Quantifying Goodness of Fit of the Model</h2>
<p>Often, it is useful to check how good the (total) model we estimated fits the data.</p>
<p>. . .</p>
<p>We can do that easily by asking <em>how much of the variability in the data is accounted for by the model?</em></p>
<p>. . .</p>
<p>If we only have one IV (<span class="math inline">\(x\)</span>), then we can simply square the correlation coefficient:</p>
<p><span class="math display">\[
R^2 = r^2
\]</span></p>
<p>In study time example, <span class="math inline">\(R^2\)</span> = 0.63² = 0.4 –&gt; we accounted for 40% of the overall variance in grades!</p>
<p>. . .</p>
<p>More generally, we can calculate <span class="math inline">\(R^2\)</span> with the Sum of Squared Variances:</p>
<p><span class="math display">\[
R^2 = \frac{SS_{model}}{SS_{total}} = 1-\frac{SS_{error}}{SS_{total}}
\]</span></p>
<p>. . .</p>
<p>With a sample of sufficient size, it is possible to get highly significant values that still explain very little of the total variance (i.e., little <em>practical</em> significance despite <em>statistical</em> significance)</p>
<div class="notes">
<p><span class="math inline">\(R^2\)</span> is the name of the Goodness of Fit stat!</p>
<p>A small R² tells us that even though a model might be significant, it may only explain a small amount of information in the DV</p>
</div>
</section>
<section id="fitting-more-complex-models" class="level2">
<h2 class="anchored" data-anchor-id="fitting-more-complex-models">Fitting More Complex Models</h2>
<p>Often we want to know the effects of <em>multiple variables</em> (IVs) on some outcome.</p>
<p>Example:<br>
Some students have taken a very similar class before, so there might not only be the effect of <code>studyTime</code> on <code>grades</code>, but also of having taken a <code>priorClass</code>.</p>
<p>. . .</p>
<div class="columns">
<div class="column">
<p>We can built a model that takes both into account by simply adding the “weight” and the IV (<code>priorClass</code>) to the model:</p>
<p><span class="math inline">\(\hat{y} = \hat{\beta_1}*studyTime + \hat{\beta_2}*priorClass + \hat{\beta_0}\)</span></p>
<div class="incremental">
<ul class="incremental">
<li>To model <code>priorClass</code>, i.e.&nbsp;whether each individual has taken a previous class or not, we use <strong>dummy coding</strong> (0=no, 1=yes).</li>
<li>This means, for those who have <em>not</em> taken a class, the whole part of the equation (<span class="math inline">\(\hat{\beta_2} * priorClass\)</span>) will be zero - we will add it for the others.</li>
<li><span class="math inline">\(\hat{\beta_2}\)</span> is thus the difference in means between the two groups!</li>
<li><span class="math inline">\(\hat{\beta_1}\)</span> is the regression slope of <code>studyTime</code> across data points/regardless of whether someone has taken a class before.</li>
</ul>
</div>
</div><div class="column">
<p>If we plot the data, we can see that both IVs seem to have an effect on grades:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>priorClass <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(df<span class="sc">$</span>priorClass)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>lmResultTwoVars <span class="ot">&lt;-</span> <span class="fu">lm</span>(grade <span class="sc">~</span> studyTime <span class="sc">+</span> priorClass, <span class="at">data =</span> df)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(lmResultTwoVars)</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df,<span class="fu">aes</span>(studyTime,grade,<span class="at">shape=</span>priorClass)) <span class="sc">+</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">3</span>) <span class="sc">+</span> <span class="fu">xlim</span>(<span class="dv">0</span>,<span class="dv">5</span>) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="dv">70</span>,<span class="dv">100</span>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p<span class="sc">+</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope=</span>lmResultTwoVars<span class="sc">$</span>coefficients[<span class="dv">2</span>],</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">intercept=</span>lmResultTwoVars<span class="sc">$</span>coefficients[<span class="dv">1</span>],<span class="at">lineype=</span><span class="st">'dotted'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in geom_abline(slope = lmResultTwoVars$coefficients[2], intercept =
lmResultTwoVars$coefficients[1], : Ignoring unknown parameters: `lineype`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># p &lt;- p+</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   annotate('segment',x=2,xend=3,</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co">#            y=lmResultTwoVars$coefficients[1]+</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co">#              2*lmResultTwoVars$coefficients[2],</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co">#            yend=lmResultTwoVars$coefficients[1]+</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co">#              2*lmResultTwoVars$coefficients[2],</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co">#            color='blue') +</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co">#   annotate('segment',x=3,xend=3,</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co">#            y=lmResultTwoVars$coefficients[1]+</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="co">#              2*lmResultTwoVars$coefficients[2],</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co">#            yend=lmResultTwoVars$coefficients[1]+</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="co">#              3*lmResultTwoVars$coefficients[2],</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="co">#            color='blue')</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p<span class="sc">+</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope=</span>lmResultTwoVars<span class="sc">$</span>coefficients[<span class="dv">2</span>],</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>              <span class="at">intercept=</span>lmResultTwoVars<span class="sc">$</span>coefficients[<span class="dv">1</span>]<span class="sc">+</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>                lmResultTwoVars<span class="sc">$</span>coefficients[<span class="dv">3</span>],</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>              <span class="at">linetype=</span><span class="st">'dashed'</span>) </span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p<span class="sc">+</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">'segment'</span>,<span class="at">x=</span><span class="dv">2</span>,<span class="at">xend=</span><span class="dv">2</span>,</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>           <span class="at">y=</span>lmResultTwoVars<span class="sc">$</span>coefficients[<span class="dv">1</span>]<span class="sc">+</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>             <span class="dv">2</span><span class="sc">*</span>lmResultTwoVars<span class="sc">$</span>coefficients[<span class="dv">2</span>],</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>           <span class="at">yend=</span>lmResultTwoVars<span class="sc">$</span>coefficients[<span class="dv">1</span>]<span class="sc">+</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>             lmResultTwoVars<span class="sc">$</span>coefficients[<span class="dv">3</span>] <span class="sc">+</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>             <span class="dv">2</span><span class="sc">*</span>lmResultTwoVars<span class="sc">$</span>coefficients[<span class="dv">2</span>],</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>           <span class="at">linetype=</span><span class="st">'dotted'</span>,<span class="at">size=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"No"</span>, <span class="st">"Yes"</span>)</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Previous course"</span></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in scale_color_discrete(limits = c(0, 1), labels = c("No", "Yes")): Continuous limits supplied to discrete scale.
ℹ Did you mean `limits = factor(...)` or `scale_*_continuous()`?</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="W10_GLM_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
<div class="notes">
<p>How can we tell from the plot that both IVs might have an effect?</p>
</div>
</section>
<section id="interactions-between-variables" class="level2">
<h2 class="anchored" data-anchor-id="interactions-between-variables">Interactions Between Variables</h2>
<p>We previously assumed that the effect of <code>studyTime</code> on <code>grade</code> was the same for both groups - but sometimes we expect that this regression slope differs per group!</p>
<p>E.g., due to prior knowledge from another class, it may be <em>easier</em> to profit from studying the new materials (i.e., steeper slope). Or it may be <em>harder</em> due to diminishing marginal returns (i.e., flatter slope).</p>
<p>. . .</p>
<p><br>
This is what we call an <strong>interaction</strong>: The effect of one variable depends on the value of another variable.</p>
<p>Thus, <code>priorClass</code> can have a <strong>main effect</strong> on <code>grade</code> (i.e., independent of <code>studyTime</code>): “I already know more, so I don’t need to study”.<br>
But it can also <strong>interact</strong> with <code>studyTime</code>: “Due to my prior knowledge, I can study more efficiently.”</p>
</section>
<section id="interaction-example" class="level2">
<h2 class="anchored" data-anchor-id="interaction-example">Interaction Example</h2>
<p>Example: What is the effect of caffeine on public speaking?</p>
<p><br>
</p>
<div class="columns">
<div class="column" style="width:60%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234567</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">group=</span><span class="fu">c</span>(<span class="fu">rep</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">10</span>),</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rep</span>(<span class="dv">1</span>,<span class="dv">10</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">caffeine=</span><span class="fu">runif</span>(<span class="fu">n</span>())<span class="sc">*</span><span class="dv">100</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">speaking=</span><span class="fl">0.5</span><span class="sc">*</span>caffeine<span class="sc">*-</span>group <span class="sc">+</span> group<span class="sc">*</span><span class="dv">20</span> <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">20</span>)<span class="sc">*</span><span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">anxiety=</span><span class="fu">ifelse</span>(group<span class="sc">==</span><span class="dv">1</span>,<span class="st">'anxious'</span>,<span class="st">'notAnxious'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># perform linear regression with caffeine as independent variable</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>lmResultCaffeine <span class="ot">&lt;-</span> <span class="fu">lm</span>(speaking <span class="sc">~</span> caffeine, <span class="at">data =</span> df)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lmResultCaffeine)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = speaking ~ caffeine, data = df)

Residuals:
    Min      1Q  Median      3Q     Max 
-33.096 -16.024   5.014  16.453  26.979 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)
(Intercept)  -7.4132     9.1653  -0.809    0.429
caffeine      0.1676     0.1508   1.111    0.281

Residual standard error: 19.19 on 18 degrees of freedom
Multiple R-squared:  0.06419,   Adjusted R-squared:  0.0122 
F-statistic: 1.235 on 1 and 18 DF,  p-value: 0.2811</code></pre>
</div>
</div>
</div><div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df,<span class="fu">aes</span>(caffeine,speaking)) <span class="sc">+</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>) <span class="sc">+</span> <span class="fu">geom_point</span>()</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>p1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="W10_GLM_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="384"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
<p>. . .</p>
<p>There doesn’t seem to be a “direct” (bivariate) effect:</p>
</section>
<section id="interaction-example-two-main-effects" class="level2">
<h2 class="anchored" data-anchor-id="interaction-example-two-main-effects">Interaction Example: Two main effects</h2>
<p>What if we have the hypothesis that <code>anxiety</code> also affects public speaking?</p>
<p><br>
</p>
<div class="columns">
<div class="column" style="width:60%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compute linear regression adding anxiety to model</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>lmResultCafAnx <span class="ot">&lt;-</span> <span class="fu">lm</span>(speaking <span class="sc">~</span> caffeine <span class="sc">+</span> anxiety, <span class="at">data =</span> df)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lmResultCafAnx)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = speaking ~ caffeine + anxiety, data = df)

Residuals:
    Min      1Q  Median      3Q     Max 
-32.968  -9.743   1.351  10.530  25.361 

Coefficients:
                  Estimate Std. Error t value Pr(&gt;|t|)
(Intercept)       -12.5812     9.1967  -1.368    0.189
caffeine            0.1313     0.1446   0.908    0.377
anxietynotAnxious  14.2328     8.2324   1.729    0.102

Residual standard error: 18.21 on 17 degrees of freedom
Multiple R-squared:  0.2041,    Adjusted R-squared:  0.1105 
F-statistic:  2.18 on 2 and 17 DF,  p-value: 0.1436</code></pre>
</div>
</div>
</div><div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">#TODO add individual regression lines per group but with identical slope?</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df,<span class="fu">aes</span>(caffeine,speaking,<span class="at">color=</span>anxiety,<span class="at">group=</span><span class="cn">NA</span>)) <span class="sc">+</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">data=</span>df <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">speaking.m=</span><span class="fu">mean</span>(speaking), <span class="at">.by=</span>anxiety),</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">yintercept=</span>speaking.m, <span class="at">color=</span>anxiety),</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype=</span><span class="st">"dashed"</span>, <span class="at">size=</span><span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>p2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The following aesthetics were dropped during statistical transformation:
colour.
ℹ This can happen when ggplot fails to infer the correct grouping structure in
  the data.
ℹ Did you forget to specify a `group` aesthetic or to convert a numerical
  variable into a factor?</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="W10_GLM_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="384"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
<p>. . .</p>
<p>The new model is still not significant. This is due to the fact that we only look at <strong>additive effects</strong> (main effects). But neither caffeine nor anxiety alone/independently predict public speaking performance.</p>
<p>. . .</p>
<p>From the plot, however, it looks like the effect of caffeine is indeed different for the two anxiety groups: Increasing for non-anxious people and decreasing for anxious ones.</p>
<p>In other words: We need to have a model that allows to fit different regression <em>slopes</em> to both groups.</p>
<div class="notes">
<p>explain additive effects: look at average caffeine effect, then add mean for anxiety groups (but: both not significant here!)</p>
<p>problem of independent main effects: also if you bring together two findings from two different papers =&gt; no information about interaction of predictors</p>
</div>
</section>
<section id="interaction-example-full-model" class="level2">
<h2 class="anchored" data-anchor-id="interaction-example-full-model">Interaction Example: Full model</h2>
<p>To allow for different slopes for each group (i.e.&nbsp;for the effect of caffeine to vary between the anxiety groups), we have to model the <em>interaction</em> as well.</p>
<div class="columns">
<div class="column" style="width:60%;">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = speaking ~ caffeine + anxiety + caffeine:anxiety, 
    data = df)

Residuals:
    Min      1Q  Median      3Q     Max 
-11.385  -7.103  -0.444   6.171  13.458 

Coefficients:
                            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)                 17.43085    5.43012   3.210 0.005461 ** 
caffeine                    -0.47416    0.09664  -4.906 0.000158 ***
anxietynotAnxious          -43.44873    7.79141  -5.576 4.17e-05 ***
caffeine:anxietynotAnxious   1.08395    0.12931   8.382 3.01e-07 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 8.085 on 16 degrees of freedom
Multiple R-squared:  0.8524,    Adjusted R-squared:  0.8247 
F-statistic:  30.8 on 3 and 16 DF,  p-value: 7.014e-07</code></pre>
</div>
</div>
</div><div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>df_anx <span class="ot">&lt;-</span> </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(anxiety<span class="sc">==</span><span class="st">'anxious'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">y=</span>lmResultInteraction<span class="sc">$</span>fitted.values[df<span class="sc">$</span>anxiety<span class="sc">==</span><span class="st">'anxious'</span>])</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>df_notanx <span class="ot">&lt;-</span> </span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(anxiety<span class="sc">==</span><span class="st">'notAnxious'</span>)<span class="sc">%&gt;%</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">y=</span>lmResultInteraction<span class="sc">$</span>fitted.values[df<span class="sc">$</span>anxiety<span class="sc">==</span><span class="st">'notAnxious'</span>])</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df,<span class="fu">aes</span>(caffeine,speaking,<span class="at">color=</span>anxiety,<span class="at">group=</span>anxiety)) <span class="sc">+</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>) <span class="sc">+</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>)</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_line(data=df_anx,</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">#            aes(caffeine,y),linetype='dashed') +</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_line(data=df_notanx,</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">#            aes(caffeine,y),linetype='dotted')</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>p3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="W10_GLM_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="384"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
<p>. . .</p>
<p>The model is now significant! There is an <em>interaction</em> between <code>caffeine</code> and <code>anxiety</code>. Interestingly, the <em>main effects</em> are also significant now even though they were not in the previous models (because the residual variance has been reduced drastically from 18 to 8 by the highly significant interaction).</p>
<p>Note: <code>speaking ~ caffeine * anxiety</code> is shorthand for <code>speaking ~ caffeine + anxiety + caffeine:anxiety</code></p>
</section>
<section id="convert-glm-to-anova" class="level2">
<h2 class="anchored" data-anchor-id="convert-glm-to-anova">Convert GLM to ANOVA</h2>
<p>The interpretation of the coefficients of a GLM when interactions are included is not as straight forward compared to an ANOVA!</p>
<p>. . .</p>
<p>If you want to report the “typical” ANOVA table with main effects and the general interaction:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(lmResultInteraction)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Response: speaking
                 Df Sum Sq Mean Sq F value   Pr(&gt;F)    
caffeine          1  454.8   454.8  6.9578 0.017911 *  
anxiety           1  991.5   991.5 15.1678 0.001288 ** 
caffeine:anxiety  1 4593.4  4593.4 70.2662 3.01e-07 ***
Residuals        16 1045.9    65.4                     
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>. . .</p>
<p>Note: The <em>p</em>-values are different between the GLM and the ANOVA outputs because effects including factors are coded slightly differently (dummy vs.&nbsp;effect coding):</p>
<p>Dummy coding uses the first level as a default and compares the remaining levels to it (<span class="math inline">\(0\)</span> vs.&nbsp;<span class="math inline">\(1\)</span>).<br>
Effect coding takes the overall mean as an abstract comparison (<span class="math inline">\(-.5\)</span> vs.&nbsp;<span class="math inline">\(+.5\)</span>).<br>
This difference is resembled in the output tables as <code>anxietynotAnxious</code> (GLM) vs.&nbsp;<code>anxiety</code> (ANOVA).</p>
<div class="notes">
<p>interpretation coefficients:</p>
<p>intercept: intercept of anxious group!</p>
<p>intercept not anxious: difference intercept anxious vs.&nbsp;notanxious</p>
<p>slope anxious: only for the anxious group!</p>
<p>slope not anxious: diff in slopes</p>
<p>no main effects!!!</p>
</div>
</section>
<section id="model-comparison" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="model-comparison">Model Comparison</h2>
<p>Sometimes, we want to compare two (<em>nested</em>!) models to see which one fits the data better.</p>
<p>We can do so by using the <code>anova()</code>* function in R:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(lmResultCafAnx, lmResultInteraction)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Model 1: speaking ~ caffeine + anxiety
Model 2: speaking ~ caffeine + anxiety + caffeine:anxiety
  Res.Df    RSS Df Sum of Sq      F   Pr(&gt;F)    
1     17 5639.3                                 
2     16 1045.9  1    4593.4 70.266 3.01e-07 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>This shows that Model 2, incl.&nbsp;the interaction, is to be preferred.</p>
<p>. . .</p>
<p><em>Note</em>: We can only meaningfully use this method with so-called nested models, which means that the simpler (<em>reduced</em>) model only contains variables also included in the more complex (<em>full</em>) model.</p>

<div class="no-row-height column-margin column-container"><div class="margin-aside">
<p>*Yes, it is <em>kind of</em> an ANOVA as well, in that (a ratio of) squared errors is compared to an <span class="math inline">\(F\)</span>-distribution…</p>
</div></div><div class="notes">
<p>Wald compares the ratio of squared errors to an F-distribution (sound familiar from ANOVA?), while likelihood ratio compares the ratio of likelihoods to a χ2 distribution</p>
</div>
</section>
<section id="criticizing-our-model-and-checking-assumptions" class="level2">
<h2 class="anchored" data-anchor-id="criticizing-our-model-and-checking-assumptions">Criticizing Our Model and Checking Assumptions</h2>
<p>“Garbage in, garbage out” - we have to make sure our model is properly specified!</p>
<p>. . .</p>
<p><em>Properly specified</em> = having included the appropriate IVs.</p>
<p>. . .</p>
<p>The model also needs to satisfy the <strong>assumptions</strong> of the statistical method (= GLM).</p>
<p>One important assumption of the GLM is that <em>the residuals are normally distributed</em>.</p>
<p>This assumption can be violated by a not properly specified model or because the data are inappropriate for the statistical model.</p>
<p>. . .</p>
<p>We can use a <strong>Q-Q plot</strong>, which represents the quantiles of two distributions/variables (e.g., the data and a normal distribution of the same data) against each other.</p>
<p>If the data points diverge substantially from the line (especially in the extremes), we can conclude that the residuals are not normally distributed.</p>
</section>
<section id="model-diagnostics" class="level2">
<h2 class="anchored" data-anchor-id="model-diagnostics">Model Diagnostics</h2>
<p>To check the assumptions, we can easily run a function for model diagnostics (incl.&nbsp;Q-Q plots) in R. The function, <code>check_model()</code>, is included in the <code>performance</code> package by the <a href="https://easystats.github.io/easystats/index.html"><em>easystats</em></a> team (who make great packages for everything related to statistical modeling!)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("easystats")</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(performance)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="fu">check_model</span>(lmResultInteraction)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="W10_GLM_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="notes">
<p>We’re not going into detail about all these diagnostics (and hard to see!), but it is always a good idea to run diagnostics/check assumptions for your models!</p>
</div>
</section>
<section id="remark-predicting-in-a-statistical-context" class="level2">
<h2 class="anchored" data-anchor-id="remark-predicting-in-a-statistical-context">Remark: “Predicting” in a Statistical Context</h2>
<p>We neither mean “predicting before seeing the data/in the future” nor mean to imply <em>causality</em>!</p>
<p>. . .</p>
<p>It simply refers to fitting a model to the data: We estimate (or predict) values for the DV (<span class="math inline">\(\hat{y}\)</span>) and the IVs are often referred to as <em>predictors</em>.</p>
<div class="notes">
<p>Related to: predicting future values</p>
</div>
</section>
</section>
<section id="multivariate-statistics" class="level1">
<h1>Multivariate Statistics</h1>
<p><em>Multivariate</em> = involving more than one (dependent) variable.</p>
<p>Usually, the distinction between dependent and independent variables is not very strict (rather depends on the model than on the data itself). In the following section, we are interested in how a number of variables relate to one another (no clear predictor vs.&nbsp;criterion).</p>
<div class="incremental">
<ol class="incremental" type="1">
<li><p><strong>Clustering</strong>: Understand the structure that exists in the data, find clusters of observations or variables that are similar.<br>
=&gt; From dimensions to categories</p></li>
<li><p><strong>Dimensionality reduction</strong>: Reduce a large set of variables to fewer, retaining as much information as possible.<br>
=&gt; From many dimensions to fewer dimensions</p></li>
</ol>
</div>
<p>. . .</p>
<p>These two methods belong to the class of <em>unsupervised learning</em>. Before, we have only dealt with <em>supervised learning</em> (e.g., regression, ANOVA). There are also methods for multivariate, supervised learning (e.g., MANOVA).</p>
<p>Note: Unsupervised learning techniques are very <em>explorative</em> in nature. It is a different approach to learning from data compared to hypothesis testing. Explorative methods are usually used in science to create a first insight into new phenomena that can develop into hypotheses further down the line.</p>
<div class="notes">
<p>Supervised: we know the value of the DV that we’re trying to predict (try to find best model predictions).</p>
<p>Unsupervised: we don’t have specific value to predict, we try to discover (patterns that help understand). Requires some assumptions about pattern.</p>
<p>–&gt; does not necessarily have a “right” answer!</p>
</div>
<section id="multivariate-data-an-example" class="level2">
<h2 class="anchored" data-anchor-id="multivariate-data-an-example">Multivariate Data: An Example</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># import MASS first because it otherwise will mask dplyr::select</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggdendro)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Paket 'ggdendro' wurde unter R Version 4.4.2 erstellt</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(psych)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attache Paket: 'psych'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Die folgenden Objekte sind maskiert von 'package:ggplot2':

    %+%, alpha</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gplots)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Paket 'gplots' wurde unter R Version 4.4.2 erstellt</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attache Paket: 'gplots'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Das folgende Objekt ist maskiert 'package:stats':

    lowess</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pdist)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(factoextra)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Paket 'factoextra' wurde unter R Version 4.4.2 erstellt</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Welcome! Want to learn more? See two factoextra-related books at https://goo.gl/ve3WBa</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(viridis)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Paket 'viridis' wurde unter R Version 4.4.2 erstellt</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Lade nötiges Paket: viridisLite</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mclust)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Paket 'mclust' wurde unter R Version 4.4.2 erstellt</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Package 'mclust' version 6.1.1
Type 'citation("mclust")' for citing this R package in publications.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attache Paket: 'mclust'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Das folgende Objekt ist maskiert 'package:psych':

    sim</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Das folgende Objekt ist maskiert 'package:purrr':

    map</code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_minimal</span>())</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>behavdata <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">'Data/meaningful_variables.csv'</span>,</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)  </span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>demoghealthdata <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">'Data/demographic_health.csv'</span>,</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>                            <span class="at">show_col_types =</span> <span class="cn">FALSE</span>) </span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a><span class="co"># recode Sex variable from 0/1 to Male/Female</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>demoghealthdata <span class="ot">&lt;-</span> demoghealthdata <span class="sc">%&gt;%</span></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Sex =</span> <span class="fu">recode_factor</span>(Sex, <span class="st">`</span><span class="at">0</span><span class="st">`</span><span class="ot">=</span><span class="st">"Male"</span>, <span class="st">`</span><span class="at">1</span><span class="st">`</span><span class="ot">=</span><span class="st">"Female"</span>))</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a><span class="co"># combine the data into a single data frame by subcode</span></span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>alldata <span class="ot">&lt;-</span> <span class="fu">merge</span>(behavdata, demoghealthdata, <span class="at">by=</span><span class="st">'subcode'</span>)</span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>rename_list <span class="ot">=</span> <span class="fu">list</span>(<span class="st">'upps_impulsivity_survey'</span> <span class="ot">=</span> <span class="st">'UPPS'</span>, <span class="st">'sensation_seeking_survey'</span> <span class="ot">=</span> <span class="st">'SSS'</span>,</span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'dickman_survey'</span> <span class="ot">=</span> <span class="st">'Dickman'</span>,  <span class="st">'bis11_survey'</span> <span class="ot">=</span> <span class="st">'BIS11'</span>, </span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'spatial_span'</span> <span class="ot">=</span> <span class="st">'spatial'</span>, <span class="st">'digit_span'</span> <span class="ot">=</span> <span class="st">'digit'</span>,</span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'adaptive_n_back'</span> <span class="ot">=</span> <span class="st">'nback'</span>, <span class="st">'dospert_rt_survey'</span> <span class="ot">=</span> <span class="st">'dospert'</span>,</span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'motor_selective_stop_signal.SSRT'</span> <span class="ot">=</span> <span class="st">'SSRT_motorsel'</span>,</span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'stim_selective_stop_signal.SSRT'</span> <span class="ot">=</span> <span class="st">'SSRT_stimsel'</span>,</span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'stop_signal.SSRT_low'</span> <span class="ot">=</span> <span class="st">'SSRT_low'</span>,</span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'stop_signal.SSRT_high'</span> <span class="ot">=</span> <span class="st">'SSRT_high'</span>)</span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a>impulsivity_variables <span class="ot">=</span> <span class="fu">c</span>(<span class="st">'Sex'</span>)</span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a>keep_variables <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"spatial.forward_span"</span>, <span class="st">"spatial.reverse_span"</span>, <span class="st">"digit.forward_span"</span>,<span class="st">"digit.reverse_span"</span>, <span class="st">"nback.mean_load"</span>)</span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (potential_match <span class="cf">in</span> <span class="fu">names</span>(alldata)){</span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (n <span class="cf">in</span> <span class="fu">names</span>(rename_list)){</span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">str_detect</span>(potential_match, n)){</span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true" tabindex="-1"></a>      <span class="co"># print(sprintf('found match: %s %s', n, potential_match))</span></span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true" tabindex="-1"></a>      replacement_name <span class="ot">&lt;-</span> <span class="fu">str_replace</span>(potential_match, n, <span class="fu">toString</span>(rename_list[n]))</span>
<span id="cb52-29"><a href="#cb52-29" aria-hidden="true" tabindex="-1"></a>      <span class="fu">names</span>(alldata)[<span class="fu">names</span>(alldata) <span class="sc">==</span> potential_match] <span class="ot">&lt;-</span> replacement_name</span>
<span id="cb52-30"><a href="#cb52-30" aria-hidden="true" tabindex="-1"></a>      impulsivity_variables <span class="ot">&lt;-</span> <span class="fu">c</span>(impulsivity_variables, replacement_name)</span>
<span id="cb52-31"><a href="#cb52-31" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb52-32"><a href="#cb52-32" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb52-33"><a href="#cb52-33" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb52-34"><a href="#cb52-34" aria-hidden="true" tabindex="-1"></a>impulsivity_data <span class="ot">&lt;-</span> alldata[,impulsivity_variables] <span class="sc">%&gt;%</span></span>
<span id="cb52-35"><a href="#cb52-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>()</span>
<span id="cb52-36"><a href="#cb52-36" aria-hidden="true" tabindex="-1"></a>ssrtdata <span class="ot">=</span> alldata[,<span class="fu">c</span>(<span class="st">'subcode'</span>, <span class="fu">names</span>(alldata)[<span class="fu">grep</span>(<span class="st">'SSRT_'</span>, <span class="fu">names</span>(alldata))])] <span class="sc">%&gt;%</span> </span>
<span id="cb52-37"><a href="#cb52-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb52-38"><a href="#cb52-38" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>stop_signal.proactive_SSRT_speeding)</span>
<span id="cb52-39"><a href="#cb52-39" aria-hidden="true" tabindex="-1"></a>upps_data <span class="ot">&lt;-</span> alldata <span class="sc">%&gt;%</span></span>
<span id="cb52-40"><a href="#cb52-40" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">'UPPS'</span>), <span class="st">'subcode'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb52-41"><a href="#cb52-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="fu">gsub</span>(<span class="st">"UPPS."</span>, <span class="st">""</span>, <span class="fu">names</span>(.)))</span>
<span id="cb52-42"><a href="#cb52-42" aria-hidden="true" tabindex="-1"></a>impdata <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(ssrtdata, upps_data) <span class="sc">%&gt;%</span> </span>
<span id="cb52-43"><a href="#cb52-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb52-44"><a href="#cb52-44" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>subcode) <span class="sc">%&gt;%</span> </span>
<span id="cb52-45"><a href="#cb52-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale</span>() <span class="sc">%&gt;%</span></span>
<span id="cb52-46"><a href="#cb52-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb52-47"><a href="#cb52-47" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">SSRT_motor =</span> SSRT_motorsel,</span>
<span id="cb52-48"><a href="#cb52-48" aria-hidden="true" tabindex="-1"></a>                <span class="at">SSRT_stim =</span> SSRT_stimsel,</span>
<span id="cb52-49"><a href="#cb52-49" aria-hidden="true" tabindex="-1"></a>                <span class="at">UPPS_pers =</span> lack_of_perseverance,</span>
<span id="cb52-50"><a href="#cb52-50" aria-hidden="true" tabindex="-1"></a>                <span class="at">UPPS_premed =</span> lack_of_premeditation,</span>
<span id="cb52-51"><a href="#cb52-51" aria-hidden="true" tabindex="-1"></a>                <span class="at">UPPS_negurg =</span> negative_urgency,</span>
<span id="cb52-52"><a href="#cb52-52" aria-hidden="true" tabindex="-1"></a>                <span class="at">UPPS_posurg =</span> positive_urgency,</span>
<span id="cb52-53"><a href="#cb52-53" aria-hidden="true" tabindex="-1"></a>                <span class="at">UPPS_senseek =</span> sensation_seeking</span>
<span id="cb52-54"><a href="#cb52-54" aria-hidden="true" tabindex="-1"></a>                )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(subcode)`</code></pre>
</div>
</div>
<p>How do different aspects of psychological function (self-control etc.) relate to one another?</p>
<p>10h battery of cognitive tests and surveys, N = 522, 9 measures of interest!</p>
<p>Measures:</p>
<ul>
<li><p><em>Response inhibition</em>: ability to quickly stop an action (measured with the stop-signal task, measure is called <em>stop-signal reaction time (SSRT)</em> - we have 4 different versions of this measure).</p></li>
<li><p><em>Impulsivity</em>: tendency to make decisions on impulse, without regard of potential consequences (<em>UPPS-P</em> survey, assesses 5 facets of impulsivity).</p></li>
</ul>
</section>
<section id="visualizing-multivariate-data" class="level2">
<h2 class="anchored" data-anchor-id="visualizing-multivariate-data">Visualizing Multivariate Data</h2>
<p>Hard (impossible?) for us to visualize more than three dimensions/variables.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="W10_GLM_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="768"></p>
<figcaption>Scatterplot of matrices for the nine variables in the self-control dataset. The diagonal elements in the matrix show the histogram for each of the individual variables. The lower left panels show scatterplots of the relationship between each pair of variables, and the upper right panel shows the correlation coefficient for each pair of variables.</figcaption>
</figure>
</div>
</div>
</div>
<div class="notes">
<p>What do you see?</p>
<p>each row/col –&gt; single variable<br>
diagonal: dist each var<br>
lower triangle: scatterplot each pair, regression line –&gt; relationship<br>
upper: correlation coefficient</p>
</div>
</section>
<section id="heatmap" class="level2">
<h2 class="anchored" data-anchor-id="heatmap">Heatmap</h2>
<p>Visualize correlations:</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="W10_GLM_files/figure-html/hmap-1.png" class="img-fluid figure-img" width="768"></p>
<figcaption>Heatmap of the correlation matrix for the nine self-control variables. The brighter yellow areas in the top left and bottom right highlight the higher correlations within the two subsets of variables.</figcaption>
</figure>
</div>
</div>
</div>
<p>We can see clear clusters: SSRT and UPPS have greater intercorrelations than correlations with the other measure.</p>
</section>
<section id="heatmap-2" class="level2">
<h2 class="anchored" data-anchor-id="heatmap-2">Heatmap 2</h2>
<p>Heatmaps are especially helpful if we have a large number of variables, such as in neuroimaging! Below you can see the <em>functional connectivity</em> of &gt;300 brain regions:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/Heatmap2.png" class="img-fluid figure-img" width="445"></p>
<figcaption>Heatmap of correlation coefficients of brain activity between 316 regions of the left hemisphere of a single individual. Yellow: strong positive correlations, blue: strong negative correlations</figcaption>
</figure>
</div>
<div class="notes">
<p>large blocks of pos corr: major connected networks in the brain</p>
</div>
</section>
<section id="clustering" class="level2">
<h2 class="anchored" data-anchor-id="clustering">Clustering</h2>
<p><strong>Clustering</strong>: Identifying groups of related observations or variables within a dataset, based on the similarity of the values of the observations.</p>
<p>. . .</p>
<p><strong>Similarity</strong>: Distance between values.</p>
<p><strong>Euclidean Distance</strong>: Length of the line that connects two data points:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>euc_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">4</span>), <span class="at">y=</span><span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>))</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(euc_df, <span class="fu">aes</span>(x,y)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="dv">5</span>) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="dv">4</span>) <span class="sc">+</span> </span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">'segment'</span>, <span class="at">x=</span><span class="dv">1</span>, <span class="at">y=</span><span class="dv">2</span>, <span class="at">xend=</span><span class="dv">4</span>, <span class="at">yend=</span><span class="dv">3</span>, <span class="at">linetype=</span><span class="st">'dotted'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="W10_GLM_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="288"></p>
</figure>
</div>
</div>
</div>
<p><span class="math display">\[
d(x,y) = \sqrt{(x_1 - x_2)^2 + (y_1 - y_2)^2}
\]</span></p>
<p>. . .</p>
<p>Euclidean Distance is sensitive to variability in both variables –&gt; <em>scale</em> data before! (e.g., z-transformation using R’s <code>scale</code> function)</p>
<div class="notes">
<p>Clustering: finding set of groups that have the lowest distance between their members.</p>
<p>Euclidean Dist: Pythagorean theorem<br>
–&gt; can be extended to more than two dimensions!</p>
<p>Scale: calculate z-score, standardizing</p>
<p>Example: Relation between height and weight =&gt; it shouldn’t make a difference if we rescale the data from m to cm or from kg to pounds.</p>
</div>
</section>
<section id="k-means-clustering" class="level2">
<h2 class="anchored" data-anchor-id="k-means-clustering">K-Means Clustering</h2>
<p><strong>K-means clustering</strong>: Identifies a set of cluster centers &amp; then assigns each data point to the cluster whose center is the closest (Euclidean Distance!).</p>
<div class="incremental">
<ol class="incremental" type="1">
<li>Decide on value for <em>K</em>, the number of clusters to be found (e.g.&nbsp;based on previous knowledge/expectations).</li>
<li>Come up with <em>k</em> locations for the centers - or <em>centroids</em> - of the clusters (e.g.&nbsp;choose data points at random to start with).</li>
<li>Compute Euclidean distance of each data point to each centroid.</li>
<li>Assign each point to a cluster, based on closest distance to centroid.</li>
<li>Recompute centroid by averaging the location of all points assigned to that cluster.</li>
<li>Repeat steps 1-5 until a stable solution is found (<em>iterative</em> process).</li>
</ol>
</div>
</section>
<section id="example-latitudelongitude-data" class="level2">
<h2 class="anchored" data-anchor-id="example-latitudelongitude-data">Example: Latitude/Longitude Data</h2>
<div class="columns">
<div class="column">
<p>Here we can see the starting points (black squares) and end points (big colored dots) for each cluster, as well as the final cluster assignment of each data point (color):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>countries <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">'Data/country_data.csv'</span>, <span class="at">na=</span><span class="fu">c</span>(<span class="st">''</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter out countries with less than 1M population</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Population2020 <span class="sc">&gt;</span> <span class="dv">500000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 166 Columns: 10
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (6): CountryCode, CountryName, Region, IncomeGroup, Continent, country
dbl (4): Population2020, latitude, longitude, GDP2020

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>latlong <span class="ot">&lt;-</span> countries <span class="sc">%&gt;%</span> </span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(latitude, longitude) </span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>k <span class="ot">=</span> <span class="dv">6</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123456</span>)</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a><span class="co"># select random starting points as the means - i.e. Forgy method</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>centroids <span class="ot">=</span> latlong[<span class="fu">sample.int</span>(<span class="fu">nrow</span>(latlong), k),]</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>iterations <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>oldCentroids <span class="ot">=</span> <span class="fu">data.frame</span>()</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>MAX_ITERATIONS <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>shouldStop <span class="ot">&lt;-</span> <span class="cf">function</span>(oldCentroids, centroids, iterations){</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (iterations <span class="sc">&gt;</span> MAX_ITERATIONS){</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="cn">TRUE</span>)</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>    } </span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">dim</span>(oldCentroids)[<span class="dv">1</span>] <span class="sc">==</span> <span class="dv">0</span>){</span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="cn">FALSE</span>)</span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">all.equal</span>(<span class="fu">as.matrix</span>(centroids), <span class="fu">as.matrix</span>(oldCentroids)) <span class="sc">==</span> <span class="cn">TRUE</span>)</span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a>getLabels <span class="ot">&lt;-</span> <span class="cf">function</span>(dataSet, centroids){</span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a>    d <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(pdist<span class="sc">::</span><span class="fu">pdist</span>(dataSet, centroids))</span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># For each element in the dataset, chose the closest centroid. </span></span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Make that centroid the element's label.</span></span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">apply</span>(d, <span class="dv">1</span>, which.min))</span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true" tabindex="-1"></a>getCentroids <span class="ot">&lt;-</span> <span class="cf">function</span>(dataSet, labels, k){</span>
<span id="cb57-28"><a href="#cb57-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Each centroid is the geometric mean of the points that</span></span>
<span id="cb57-29"><a href="#cb57-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># have that centroid's label. Important: If a centroid is empty (no points have</span></span>
<span id="cb57-30"><a href="#cb57-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># that centroid's label) you should randomly re-initialize it.</span></span>
<span id="cb57-31"><a href="#cb57-31" aria-hidden="true" tabindex="-1"></a>    newCentroids <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb57-32"><a href="#cb57-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>k){</span>
<span id="cb57-33"><a href="#cb57-33" aria-hidden="true" tabindex="-1"></a>      labeldata <span class="ot">&lt;-</span> dataSet[labels<span class="sc">==</span>i,]</span>
<span id="cb57-34"><a href="#cb57-34" aria-hidden="true" tabindex="-1"></a>      newCentroids <span class="ot">&lt;-</span> <span class="fu">rbind</span>(newCentroids, <span class="fu">apply</span>(labeldata, <span class="dv">2</span>, mean))</span>
<span id="cb57-35"><a href="#cb57-35" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb57-36"><a href="#cb57-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(newCentroids)</span>
<span id="cb57-37"><a href="#cb57-37" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb57-38"><a href="#cb57-38" aria-hidden="true" tabindex="-1"></a>all_centroids_df <span class="ot">=</span> <span class="fu">data.frame</span>(centroids) <span class="sc">%&gt;%</span></span>
<span id="cb57-39"><a href="#cb57-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">label_kmeans=</span><span class="fu">as.factor</span>(<span class="fu">seq</span>(<span class="dv">1</span>,<span class="fu">nrow</span>(.))),</span>
<span id="cb57-40"><a href="#cb57-40" aria-hidden="true" tabindex="-1"></a>         <span class="at">iter=</span><span class="dv">0</span>)</span>
<span id="cb57-41"><a href="#cb57-41" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> (<span class="sc">!</span><span class="fu">shouldStop</span>(oldCentroids, centroids, iterations)) {</span>
<span id="cb57-42"><a href="#cb57-42" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Save old centroids for convergence test. Book keeping.</span></span>
<span id="cb57-43"><a href="#cb57-43" aria-hidden="true" tabindex="-1"></a>        oldCentroids <span class="ot">=</span> centroids</span>
<span id="cb57-44"><a href="#cb57-44" aria-hidden="true" tabindex="-1"></a>        iterations <span class="ot">=</span> iterations <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb57-45"><a href="#cb57-45" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Assign labels to each datapoint based on centroids</span></span>
<span id="cb57-46"><a href="#cb57-46" aria-hidden="true" tabindex="-1"></a>        labels <span class="ot">=</span> <span class="fu">getLabels</span>(latlong, centroids)</span>
<span id="cb57-47"><a href="#cb57-47" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-48"><a href="#cb57-48" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Assign centroids based on datapoint labels</span></span>
<span id="cb57-49"><a href="#cb57-49" aria-hidden="true" tabindex="-1"></a>        centroids <span class="ot">=</span> <span class="fu">getCentroids</span>(latlong, labels, k)</span>
<span id="cb57-50"><a href="#cb57-50" aria-hidden="true" tabindex="-1"></a>        centroids_df <span class="ot">=</span> <span class="fu">data.frame</span>(centroids) <span class="sc">%&gt;%</span></span>
<span id="cb57-51"><a href="#cb57-51" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">label_kmeans=</span><span class="fu">as.factor</span>(<span class="fu">seq</span>(<span class="dv">1</span>,<span class="fu">nrow</span>(.))),</span>
<span id="cb57-52"><a href="#cb57-52" aria-hidden="true" tabindex="-1"></a>                 <span class="at">iter=</span>iterations)</span>
<span id="cb57-53"><a href="#cb57-53" aria-hidden="true" tabindex="-1"></a>        all_centroids_df <span class="ot">=</span> <span class="fu">rbind</span>(all_centroids_df, centroids_df)</span>
<span id="cb57-54"><a href="#cb57-54" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb57-55"><a href="#cb57-55" aria-hidden="true" tabindex="-1"></a><span class="co">#sprintf('Completed after %d iterations', iterations)</span></span>
<span id="cb57-56"><a href="#cb57-56" aria-hidden="true" tabindex="-1"></a>countries <span class="ot">&lt;-</span> countries <span class="sc">%&gt;%</span></span>
<span id="cb57-57"><a href="#cb57-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">label_kmeans =</span> <span class="fu">as.factor</span>(labels))</span>
<span id="cb57-58"><a href="#cb57-58" aria-hidden="true" tabindex="-1"></a>centroid_df <span class="ot">=</span> all_centroids_df <span class="sc">%&gt;%</span></span>
<span id="cb57-59"><a href="#cb57-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(iter<span class="sc">==</span>iterations)</span>
<span id="cb57-60"><a href="#cb57-60" aria-hidden="true" tabindex="-1"></a>p <span class="ot">=</span> <span class="fu">ggplot</span>(countries, <span class="fu">aes</span>(longitude, latitude, <span class="at">color=</span>label_kmeans)) <span class="sc">+</span> </span>
<span id="cb57-61"><a href="#cb57-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb57-62"><a href="#cb57-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span>centroid_df,<span class="at">alpha=</span><span class="fl">0.5</span>, <span class="at">size=</span><span class="dv">4</span>) </span>
<span id="cb57-63"><a href="#cb57-63" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>iterations){</span>
<span id="cb57-64"><a href="#cb57-64" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>k){</span>
<span id="cb57-65"><a href="#cb57-65" aria-hidden="true" tabindex="-1"></a>    iter_df <span class="ot">=</span> all_centroids_df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(iter<span class="sc">==</span>i, label_kmeans<span class="sc">==</span>j)</span>
<span id="cb57-66"><a href="#cb57-66" aria-hidden="true" tabindex="-1"></a>    prev_df <span class="ot">=</span> all_centroids_df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(iter<span class="sc">==</span>i<span class="dv">-1</span>, label_kmeans<span class="sc">==</span>j)</span>
<span id="cb57-67"><a href="#cb57-67" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">=</span> p <span class="sc">+</span>  <span class="fu">annotate</span>(<span class="st">'segment'</span>, <span class="at">x =</span> iter_df<span class="sc">$</span>longitude, </span>
<span id="cb57-68"><a href="#cb57-68" aria-hidden="true" tabindex="-1"></a>                              <span class="at">y =</span> iter_df<span class="sc">$</span>latitude,</span>
<span id="cb57-69"><a href="#cb57-69" aria-hidden="true" tabindex="-1"></a>                              <span class="at">xend =</span> prev_df<span class="sc">$</span>longitude,</span>
<span id="cb57-70"><a href="#cb57-70" aria-hidden="true" tabindex="-1"></a>                              <span class="at">yend =</span> prev_df<span class="sc">$</span>latitude, <span class="at">alpha=</span><span class="fl">0.7</span>)</span>
<span id="cb57-71"><a href="#cb57-71" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb57-72"><a href="#cb57-72" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb57-73"><a href="#cb57-73" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">data=</span>all_centroids_df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(iter<span class="sc">==</span><span class="dv">0</span>), </span>
<span id="cb57-74"><a href="#cb57-74" aria-hidden="true" tabindex="-1"></a>               <span class="at">size=</span><span class="dv">2</span>, <span class="at">shape=</span><span class="dv">15</span>, <span class="at">color=</span><span class="st">'black'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="W10_GLM_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div><div class="column">
<p>We can see that there is a reasonable overlap between clusters and continents.</p>
<p>We can further investigate this overlap with the <strong>confusion matrix</strong>, which compares membership of each cluster with the actual continents for each country:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(labels, countries<span class="sc">$</span>Continent)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      
labels AF AS EU NA OC SA
     1  5  1 36  0  0  0
     2  3 24  0  0  0  0
     3  0  0  0  0  0  7
     4  0  0  0 15  0  4
     5  0 10  0  0  6  0
     6 35  0  0  0  0  0</code></pre>
</div>
</div>
<p>Note: usually we don’t know the ground truth (i.e.&nbsp;which continent) in unsupervised learning!<br>
=&gt; confusion matrix cannot be estimated</p>
<p>Note 2: Every time we run the iterative process, we will get a different result if we use random starting points. Make sure the result is robust, e.g.&nbsp;by running the Clustering algorithm several times.)</p>
</div>
</div>
<div class="notes">
<ul>
<li>Cluster 1 contains all European countries, as well as countries from northern Africa and Asia.</li>
</ul>
<!-- -->
<ul>
<li><p>Cluster 2 contains contains Asian countries as well as several African countries.</p></li>
<li><p>Cluster 3 contains countries from the southern part of South America.</p></li>
<li><p>Cluster 4 contains all of the North American countries as well as northern South American countries.</p></li>
<li><p>Cluster 5 contains Oceania as well as several Asian countries</p></li>
<li><p>Cluster 6 contains all of the remaining African countries.</p></li>
</ul>
</div>
</section>
<section id="hierarchical-clustering" class="level2">
<h2 class="anchored" data-anchor-id="hierarchical-clustering">Hierarchical Clustering</h2>
<p><strong>Hierarchical Clustering:</strong> Also uses distances to determine clusters but also visualizes relationships in <em>dendrograms</em>.</p>
<div class="columns">
<div class="column">
<p>The most common procedure is <strong>agglomerative clustering</strong>:</p>
<div class="incremental">
<ol class="incremental" type="1">
<li>Every data point is treated as its own cluster.</li>
<li>Two clusters with the least distance (e.g.&nbsp;<em>average linkage</em>) between them are combined.</li>
<li>Repeat 1 &amp; 2 until only one cluster is left.</li>
<li>Visualize, decide on a cutoff for the amount of reasonable clusters.</li>
</ol>
</div>
</div><div class="column">
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">dist</span>(<span class="fu">t</span>(impdata))</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>hc <span class="ot">&lt;-</span> <span class="fu">hclust</span>(d, <span class="at">method=</span><span class="st">'average'</span>)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="co">#convert cluster object to use with ggplot</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>dendr <span class="ot">&lt;-</span> <span class="fu">dendro_data</span>(hc, <span class="at">type=</span><span class="st">"rectangle"</span>) </span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TODO</span><span class="co">: https://stackoverflow.com/questions/21474388/colorize-clusters-in-dendogram-with-ggplot2</span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>cutoffs <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">25</span>, <span class="dv">20</span>, <span class="dv">19</span>)</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a><span class="co">#your own labels (now rownames) are supplied in geom_text() and label=label</span></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data=</span><span class="fu">segment</span>(dendr), <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y, <span class="at">xend=</span>xend, <span class="at">yend=</span>yend)) <span class="sc">+</span> </span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data=</span><span class="fu">label</span>(dendr), <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y,<span class="at">label=</span>dendr<span class="sc">$</span>labels<span class="sc">$</span>label, <span class="at">hjust=</span><span class="dv">0</span>), <span class="at">size=</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span> <span class="fu">scale_y_reverse</span>(<span class="at">expand=</span><span class="fu">c</span>(<span class="fl">0.2</span>, <span class="dv">0</span>)) <span class="sc">+</span> </span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.line.y=</span><span class="fu">element_blank</span>(),</span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.y=</span><span class="fu">element_blank</span>(),</span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y=</span><span class="fu">element_blank</span>(),</span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y=</span><span class="fu">element_blank</span>(),</span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.background=</span><span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">"white"</span>),</span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid=</span><span class="fu">element_blank</span>()) <span class="sc">+</span> </span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_hline</span>(<span class="at">yintercept=</span>cutoffs[<span class="dv">1</span>], <span class="at">color=</span><span class="st">'blue'</span>) <span class="sc">+</span> </span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_hline</span>(<span class="at">yintercept=</span>cutoffs[<span class="dv">2</span>], <span class="at">color=</span><span class="st">'green'</span>) <span class="sc">+</span> </span>
<span id="cb60-20"><a href="#cb60-20" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_hline</span>(<span class="at">yintercept=</span>cutoffs[<span class="dv">3</span>], <span class="at">color=</span><span class="st">'red'</span>) <span class="sc">+</span> </span>
<span id="cb60-21"><a href="#cb60-21" aria-hidden="true" tabindex="-1"></a>   <span class="fu">ylim</span>(<span class="dv">30</span>, <span class="sc">-</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Scale for y is already present.
Adding another scale for y, which will replace the existing scale.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="W10_GLM_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Colored lines: different cutoffs.</p>
</div>
</div>
<p>. . .</p>
<p>There seems to be a high degree of similarity within each variable set (SSRT and UPPS) compared to between sets.<br>
=&gt; The first split separates UPPS vs.&nbsp;SSRT perfectly.</p>
<p>Within UPPS, sensation seeking stands out as the most different to the rest.</p>
<div class="notes">
<p>average linkage: average of all distances between each data point in each of two clusters.</p>
<p>Can read diagram from left to right: One supercluster that is split up more and more. Or right to left: Individual points that get joint together into bigger and bigger clusters.</p>
<p>colored lines: different cutoff values</p>
</div>
</section>
<section id="dimensionality-reduction" class="level2">
<h2 class="anchored" data-anchor-id="dimensionality-reduction">Dimensionality Reduction</h2>
<p>We often measure different variables that are highly similar to each other, e.g.&nbsp;because they are supposed to measure the same <em>construct</em>.</p>
<p>Although we might measure a particular number of variables (= <em>dimensionality</em> of data set), there may be fewer independent sources of underlying information!</p>
<p><strong>Dimensionality reduction</strong>: Reduce the number of variables by creating composite variables that reflect the underlying information.</p>
</section>
<section id="principal-component-analysis-pca" class="level2">
<h2 class="anchored" data-anchor-id="principal-component-analysis-pca">Principal Component Analysis (PCA)</h2>
<p>Aim: Find a lower-dimensional (linear) description of a set of variables (that still accounts for the maximum possible information/variance in the dataset).</p>
<p>Variance: Combination of signal + noise –&gt; find strongest common signal between variables!</p>
<p>. . .</p>
<p><strong>1st Component</strong>: explains most variance between variables, 2nd component: maximum of remaining variance - but uncorrelated with 1st…</p>
<p>. . .</p>
<div class="columns">
<div class="column">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="W10_GLM_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="384"></p>
</figure>
</div>
</div>
</div>
</div><div class="column">
<p><strong>Green arrow:</strong> 1st component, follows direction of max. variance<br>
<strong>Red arrow</strong>: 2nd component, perpendicular to 1st =&gt; uncorrelated!</p>
<p>We can run a PCA on more than two variables!</p>
</div>
</div>
<div class="notes">
<p>obtain as many components as there are variables (assuming that there are more observations than there are variables)</p>
<p>in practice: find a small number of components that can explain a large portion of the variance.</p>
<p>1st component: similar to regression line, but minimizes perpendicular distance points to line (not vertical!)</p>
</div>
</section>
<section id="pca-2" class="level2">
<h2 class="anchored" data-anchor-id="pca-2">PCA 2</h2>
<p>If we calculate a PCA on the impulsivity data, we see that there are two components (in the <em>scree plot</em>) that account for quite some variance.</p>
<p>We can also look at the variable <em>loadings</em>, which show which variable “goes into” which component to better specify what that component represents. Here we can see that one components represents (=captures variance related to) the SSRT variables, the other the UPPS.</p>
<div class="columns">
<div class="column">
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>imp_pc <span class="ot">=</span> <span class="fu">prcomp</span>(impdata,  <span class="at">scale. =</span> T)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_screeplot</span>(imp_pc, <span class="at">addlabels =</span> <span class="cn">TRUE</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">50</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="W10_GLM_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div><div class="column">
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>loading_df <span class="ot">=</span> <span class="fu">as.data.frame</span>(imp_pc<span class="sc">$</span>rotation) </span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>loading_df[<span class="st">'Variable'</span>] <span class="ot">=</span> <span class="fu">rownames</span>(loading_df)</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>loading_df <span class="ot">=</span> loading_df <span class="sc">%&gt;%</span> </span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">!</span>Variable, <span class="at">names_to=</span><span class="st">'PC'</span>, <span class="at">values_to=</span><span class="st">'Loading'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PC <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">'PC1'</span>, <span class="st">'PC2'</span>))</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(loading_df ,</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(Variable, Loading)) <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">'identity'</span>)  <span class="sc">+</span> </span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">facet_grid</span>(PC <span class="sc">~</span> .)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="W10_GLM_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
<div class="notes">
<p>Scree plot: Sometimes used to make decisions on number of components (eigenvalues plotted)</p>
<p>loadings: sign is arbitrary</p>
</div>
</section>
<section id="factor-analysis-fa" class="level2">
<h2 class="anchored" data-anchor-id="factor-analysis-fa">Factor Analysis (FA)</h2>
<p>PCA is useful for reducing the dimensionality of a dataset.<br>
The components are per definition uncorrelated –&gt; sometimes this is a limitation.<br>
PCA also doesn’t account for measurement error –&gt; possibly difficult to interpret loadings.</p>
<p>. . .</p>
<p><strong>Exploratory Factor Analysis</strong>: can also be used for dimensionality reduction.</p>
<p>Idea: Each observed variable is created through a combination of contributions from a <em>latent</em> variable + measurement error. (<em>latent</em>: can’t be directly observed!)</p>
<p>. . .</p>
<p><em>How do different measures relate to underlying factor (that gives rise to these measures)?</em></p>
</section>
<section id="fa-2" class="level2">
<h2 class="anchored" data-anchor-id="fa-2">FA 2</h2>
<div class="columns">
<div class="column">
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">200</span>                           <span class="co">#setting my sample size             </span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">3</span>)                     <span class="co">#setting the means</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>c1 <span class="ot">&lt;-</span> .<span class="dv">5</span> <span class="co"># correlation b/w WM and FR</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, c1, <span class="dv">0</span>, c1, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="dv">3</span>, <span class="dv">3</span>)  <span class="co">#setting the covariance matrix values. The "2,2" part at the tail end defines the number of rows and columns in the matrix</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">04182019</span>)  <span class="co">#setting the seed value so I can reproduce this exact sim later if need be</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>simdata <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">mvrnorm</span>(<span class="at">n=</span>N,<span class="at">mu=</span>mu,<span class="at">Sigma=</span>sigma, <span class="at">empirical=</span><span class="cn">TRUE</span>)  <span class="co">#simulate the data, as specified above</span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>latent_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(simdata)</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(latent_df) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">'WM'</span>, <span class="st">'FR'</span>, <span class="st">'IMP'</span>)</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a><span class="co"># create observed variables by matrix-multiplying the latent variables</span></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a><span class="co"># by a weight matrix </span></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123456</span>)</span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>tasknames <span class="ot">=</span> <span class="fu">c</span>(<span class="st">'nback'</span>, <span class="st">'dspan'</span>, <span class="st">'sspan'</span>, <span class="st">'ravens'</span>, <span class="st">'crt'</span>, <span class="st">'UPPS'</span>, <span class="st">'BIS11'</span>, <span class="st">'dickman'</span>)</span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>ntasks <span class="ot">=</span> <span class="fu">length</span>(tasknames)</span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>weights <span class="ot">=</span> <span class="fu">matrix</span>(<span class="at">data =</span> <span class="dv">0</span>, <span class="dv">3</span>, ntasks)</span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>weights[<span class="dv">1</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>] <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>weights[<span class="dv">2</span>, <span class="dv">4</span><span class="sc">:</span><span class="dv">5</span>] <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a>weights[<span class="dv">3</span>, <span class="dv">6</span><span class="sc">:</span><span class="dv">8</span>] <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a>noise_sd <span class="ot">=</span> .<span class="dv">6</span></span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a>observed_vals <span class="ot">=</span> <span class="fu">as.matrix</span>(latent_df) <span class="sc">%*%</span> weights <span class="sc">+</span> </span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>  MASS<span class="sc">::</span><span class="fu">mvrnorm</span>(<span class="at">n=</span>N, <span class="at">mu=</span><span class="fu">rep</span>(<span class="dv">0</span>, ntasks), <span class="at">Sigma=</span><span class="fu">diag</span>(ntasks) <span class="sc">*</span> noise_sd)</span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a>observed_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(observed_vals)</span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(observed_df) <span class="ot">&lt;-</span> tasknames</span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-24"><a href="#cb64-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-25"><a href="#cb64-25" aria-hidden="true" tabindex="-1"></a>cormtx <span class="ot">=</span> <span class="fu">t</span>(<span class="fu">cor</span>(observed_df))</span>
<span id="cb64-26"><a href="#cb64-26" aria-hidden="true" tabindex="-1"></a>gplots<span class="sc">::</span><span class="fu">heatmap.2</span>(cormtx, <span class="at">trace=</span><span class="st">'none'</span>, <span class="at">symm=</span><span class="cn">TRUE</span>, </span>
<span id="cb64-27"><a href="#cb64-27" aria-hidden="true" tabindex="-1"></a>          <span class="at">revC=</span><span class="cn">TRUE</span>,<span class="at">col=</span>viridis<span class="sc">::</span><span class="fu">viridis</span>(<span class="dv">50</span>),</span>
<span id="cb64-28"><a href="#cb64-28" aria-hidden="true" tabindex="-1"></a>          <span class="at">cellnote=</span><span class="fu">round</span>(cormtx, <span class="dv">2</span>), <span class="at">notecol=</span><span class="st">'black'</span>, <span class="at">key=</span><span class="cn">FALSE</span>,)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="W10_GLM_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="384"></p>
</figure>
</div>
</div>
</div>
</div><div class="column">
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>fa_result <span class="ot">&lt;-</span> <span class="fu">fa</span>(observed_df, <span class="at">nfactors =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Lade nötigen Namensraum: GPArotation</code></pre>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fa_result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Factor analysis with Call: fa(r = observed_df, nfactors = 3)

Test of the hypothesis that 3 factors are sufficient.
The degrees of freedom for the model is 7  and the objective function was  0.04 
The number of observations was  200  with Chi Square =  7.96  with prob &lt;  0.34 

The root mean square of the residuals (RMSA) is  0.01 
The df corrected root mean square of the residuals is  0.03 

Tucker Lewis Index of factoring reliability =  0.993
RMSEA index =  0.026  and the 10 % confidence intervals are  0 0.094
BIC =  -29.13
 With factor correlations of 
     MR1  MR2  MR3
MR1 1.00 0.03 0.47
MR2 0.03 1.00 0.03
MR3 0.47 0.03 1.00</code></pre>
</div>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fa.diagram</span>(fa_result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="W10_GLM_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
<p><strong>RMSEA</strong> (root mean square error of approximation): Measure of model fit, should be &lt; .08.</p>
<p>Use (lowest) <strong>SABIC</strong> (sample-size adjusted Bayesian information criterion) to compare models with different number of factors.</p>
<div class="notes">
<p>We can “hand over” <strong>3 factors</strong></p>
<p><strong>RMSEA</strong> quantifies how far predicted covariances (between data) are from actual covariances</p>
</div>
</section>
</section>
<section id="thanks" class="level1">
<h1>Thanks!</h1>
<p>Learning objectives:</p>
<ul>
<li>Describe the concept of the <em>general linear model/linear regression</em> and apply it to a dataset</li>
<li>Understand <em>clustering</em> and <em>dimensionality reduction,</em> incl.&nbsp;the difference between k-means and hierarchical clustering as well as PCA and FA</li>
</ul>
<p>Next:</p>
<ul>
<li>R Session on the General Linear Model</li>
<li>Linear Mixed Models</li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>